(()=>{var e={776:()=>{!function(){"use strict";var e=angular.module("RbsChangeApp");e.directive("projectChronoshopModeEditor",["RbsChange.AjaxAPI","RbsChange.ModalStack","RbsGeo.GoogleMapService",function(e,o,n){return{restrict:"A",templateUrl:"/project-chronoshop-shipping.twig",scope:{shippingMode:"=",shippingModeInfo:"=",userAddresses:"=",processEngine:"=",giftCapabilities:"="},link:function(o){function i(e){if(e){var n=angular.copy(o.relay),i={id:o.shippingModeInfo.common.id,title:o.shippingModeInfo.common.title,storeId:null,address:n.address,options:{relayCode:n.code,relay:n,search:o.search}};return angular.isFunction(o.shippingMode.getTransportableOptions)&&angular.forEach(o.shippingMode.getTransportableOptions(),(function(e,o){i.options[o]=e})),o.shippingMode.options.message&&(i.options.message=o.shippingMode.options.message),o.shippingMode.options.containsGift&&(i.options.containsGift=o.shippingMode.options.containsGift,o.shippingMode.options.giftAddMessage&&(i.options.giftAddMessage=o.shippingMode.options.giftAddMessage),o.shippingMode.options.giftMessage&&(i.options.giftMessage=o.shippingMode.options.giftMessage),o.shippingMode.options.giftAddWrap&&(i.options.giftAddWrap=o.shippingMode.options.giftAddWrap)),i}return o.shippingModeInfo.common.id===o.shippingMode.id&&o.relay&&!o.shippingMode.options.invalidMessage}o.useGoogleMap=n.valid(),o.edition=null,o.relay=!1,o.noResult=!1,o.search={zipCode:null,city:null,countryCode:null},o.relayResult=null,o.searchGoogleAddress=function(){var e=o.autocomplete.getPlace();if(!e.address_components)return o.noResult=!0,o.relayResult=!1,void o.$apply();o.search={zipCode:null,city:null,country:null},angular.forEach(e.address_components,(function(e){angular.forEach(e.types,(function(n){"postal_code"===n?o.search.zipCode=e.short_name:"locality"===n?o.search.city=e.short_name:"country"===n&&(o.search.countryCode=e.short_name)}))})),o.search.zipCode&&o.search.city?(angular.forEach(e.types,(function(n){"street_address"!==n&&"route"!==n||(o.search.address=e.name)})),o.launchSearch()):(o.noResult=!0,o.relayResult=!1,o.$apply())},o.launchSearch=function(){o.loading=!0,e.openWaitingModal(),e.getData("Rbs/Geo/Points/",{address:o.search,options:{modeId:o.shippingMode.id}}).then((function(n){o.applyResult(n.data.items),o.noResult=!1,o.loading=!1,e.closeWaitingModal()}),(function(n){console.error("launchSearch",n),o.applyResult([]),o.loading=!1,e.closeWaitingModal()}))},o.applyResult=function(e){o.relayResult=[],o.shippingMode.valid=i,o.relay=null;var n=o.shippingMode.options?o.shippingMode.options.relayCode:null;angular.forEach(e,(function(e){e.modeId=o.shippingModeInfo.common.id,e.code===n&&(o.relay=e,o.shippingMode.options.relay=e,null===o.edition&&(o.edition=!1)),o.relayResult.push(e)}))},o.selectRelay=function(e){o.edition=!1,o.setDeliveryInformation(e)},o.setDeliveryInformation=function(e){o.shippingMode.valid=i,e?(o.relay=e,o.shippingMode.options.relay=o.relay,o.shippingMode.options.relayCode=o.relay.code):(o.relay=null,delete o.shippingMode.options.relay,delete o.shippingMode.options.relayCode)},o.$watch("shippingMode.id",(function(e){e===o.shippingModeInfo.common.id&&(o.shippingMode.valid=i,o.shippingMode.atHomeAddress=null)})),o.$watch("shippingModeInfo",(function(e){if(e){e.countries&&e.countries.length>0&&(o.search.countryCode=e.countries[0].code);var a=!1;if(o.shippingMode.id===e.common.id){o.shippingMode.valid=i;var s=o.shippingMode.options;s&&(s.search&&s.search.zipCode&&s.search.city&&(o.search=s.search,a=!0),s.relayCode&&s.relay&&(o.relay=s.relay,a=!1))}o.useGoogleMap&&n.maps().then((function(e){o.autocomplete=new e.places.Autocomplete(document.getElementById("chronoshop-shipping-relay-map-auto-complete-"+o.shippingMode.deliveryIndex),{types:["address"]}),e.event.addListener(o.autocomplete,"place_changed",(function(){o.searchGoogleAddress()}))})),a?o.launchSearch():o.relay||(o.edition=!0)}}))}}}]),e.directive("projectChronoshopModeSummary",["RbsChange.ModalStack",function(e){return{restrict:"A",templateUrl:"/project-chronoshop-shipping-readonly.twig",scope:{shippingMode:"="},link:function(e){e.relay=e.shippingMode.options.relay,e.relay.address=e.shippingMode.address}}}]),e.controller("ProjectChronoshopRelayModalController",["$timeout","RbsChange.ModalStack","$scope","$uibModalInstance","relay","RbsGeo.GoogleMapService","RbsGeo.LeafletMapService",function(e,o,n,i,a,s,t){var r={latitude:a.latitude,longitude:a.longitude};function p(){var e,o,i,p,l,d,c="project-chronoshop-map-relay-"+a.code;s.valid()?s.maps().then((function(s){e=new s.LatLng(r.latitude,r.longitude),o={center:e,zoom:15},n.map=new s.Map(document.getElementById(c),o),i={position:e,map:n.map},a.options&&a.options.marker&&a.options.marker.img&&(p=a.options.marker,l=p.size?p.size[0]:31,d=p.size?p.size[1]:34,i.icon={url:p.img,size:new s.Size(l,d),origin:new s.Point(0,0),anchor:new s.Point(l/2,d/2)}),n.marker=new s.Marker(i)})):t.valid()?t.maps().then((function(s){i={},a.options&&a.options.marker&&a.options.marker.img&&(p=a.options.marker,l=p.size?p.size[0]:31,d=p.size?p.size[1]:34,i.icon=s.icon({iconUrl:p.img,iconSize:[l,d],iconAnchor:[l/2,d/2]})),o={center:e={lat:r.latitude,lng:r.longitude},zoom:15},n.map=s.map(c,o);var u=new s.TileLayer(t.defaultTileLayerName());n.map.addLayer(u),n.marker=s.marker(e,i).addTo(n.map)})):console.warn("No valid map configuration.")}function l(){o.showPrevious()}n.loadMap=!1,n.map=null,n.relay=a,n.showMap=function(){return!n.loadMap&&r&&(n.loadMap=!0,e(p,750)),!0},n.closed=function(e){return!(e.amBegin||e.amEnd||e.pmBegin||e.pmEnd)},i.result.then(l,l),n.cancel=function(){i.dismiss("cancel")}}])}()}},o={};function n(i){var a=o[i];if(void 0!==a)return a.exports;var s=o[i]={exports:{}};return e[i](s,s.exports,n),s.exports}(()=>{"use strict";n(776)})()})();